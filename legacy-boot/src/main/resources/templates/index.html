<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">
<!-- 	#1. layout 렌더링	 -->
<head lang="ko">
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div layout:fragment="content">
		<!-- 캐로셀 -->
		<!-- 캐로셀 -->
		<div id="visual"> 
			<!-- Carousel -->
			<div id="demo" class="carousel slide" data-bs-ride="carousel"> 
			  <!-- Indicators/dots -->
			  <div class="carousel-indicators">
			    <button th:each="dto, stat : ${imglist}"
			    		type="button" data-bs-target="#demo" 
			    		th:attr="data-bs-slide-to=${stat.index}" 
			    		th:classappend="${stat.index==0} ?' active'">
			    </button> 
			  </div> 
			  <!-- The slideshow/carousel -->
			  <div class="carousel-inner">
			    <div    th:each="dto, stat : ${imglist}"  
			    		th:class="'carousel-item' + ( ${stat.index==0} ?' active' : '')">
			      <img  th:src="@{'/uploads/' + ${dto.bfile}}" th:alt="${dto.btitle}"  style="height:300px; object-fit:cover;"
			      	    class="d-block w-100">
						<!-- 제목과 링크 추가 -->
						<div class="carousel-caption d-none d-md-block">
							<h2>
								<a th:href="@{/legacy/board/detail(id=${dto.id})}" th:text="${dto.btitle}"
								   style="color: #ffcc00; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); text-decoration: none;"></a>
							</h2>
							<p th:text="${dto.bcontent}"></p>
						</div>
				</div> 
			  </div> 
			  <!-- Left and right controls/icons -->
			  <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
			    <span class="carousel-control-prev-icon"></span>
			  </button>
			  <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
			    <span class="carousel-control-next-icon"></span>
			  </button>
			</div> 
		</div>
		
		<!-- 갤러리 -->
		<!-- 갤러리   data-bs-placement="bottom"   top, bottom, left , right-->
		<div id="gallery"  class="container  my-5  ">
			<div class="row">
				<div class="col-sm-4  mb-4"   th:each="dto, stat : ${imglist}"  th:if="${stat.index < 3}">
					<div class="gallery-item">
					    <a th:href="@{/legacy/board/detail(id=${dto.id})}"  >
						<img  th:src="@{'/uploads/' + ${dto.bfile}}"  
							  th:alt="${dto.btitle}"  
							  class="img-fluid  rounded-circle  img-thumbnail  d-block mx-auto"
							  data-bs-toggle="tooltip" th:attr="title=${dto.bcontent}"
							  data-bs-placement="bottom"
						/></a>
						<p    class="text-center  mt-2" th:text="${dto.bcontent}" ></p>
					</div>
				</div>
			</div>	
			
			<script>
			var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
			var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
			  return new bootstrap.Tooltip(tooltipTriggerEl)
			})
			</script>
		</div>
		 
		
		<!-- 모달 -->
		<!-- 모달 --> 
		<div class="bg-tabs-gradient">
		<div class="mymodal  container my-5 p-3 bg-white  rounded-3" >
			<div class="row">
			    <h3>GALLERY</h3>
				<div class="col-sm-3" th:each="dto , stat : ${imglist}" th:if="${stat.index<8}" >
				 <!-- 						 --> 
				 	<img   th:src="@{'/uploads/' + ${dto.bfile}}" class="img-fluid img-thumbnail cursor-pointer" 
				 		   data-bs-toggle="modal"   th:data-bs-target="'#myModal' + ${stat.index}"   /> 
				 	<!-- The Modal -->
					<div class="modal fade"    th:id="'myModal' + ${stat.index}">
					  <div class="modal-dialog  modal-xl">  <!-- modal-fullscreen-sm-down -->
					    <div class="modal-content">
					
					      <!-- Modal Header -->
					      <div class="modal-header">
					        <h4 class="modal-title"  th:text="${dto.btitle}"></h4>
					        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					      </div>
					
					      <!-- Modal body -->
					      <div class="modal-body">
					       	<img   th:src="@{'/uploads/' + ${dto.bfile}}"  class="img-fluid"/>
					      </div>
					
					      <!-- Modal footer -->
					      <div class="modal-footer">
					        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
					      </div> 
					    </div>
					  </div>
					</div> 
				 <!-- 						 -->
				</div>
			</div>		
		</div>
		</div>
		
		<!-- 테이블 + 아코디언 -->
		<!-- 테이블 + 아코디언 --> 
		<div class="myaccordion  container my-5" >
			<div class="row">
				<div class="col-sm-6">
			    	<h3>QUEST</h3>
					<!-- 검색 part -->		
					<!-- 검색 part -->		 
					<div class="mb-3 mt-3 alert alert-primary">
					  <label for="search" class="form-label">SEARCH</label>
					  <input type="search" class="form-control" id="search" placeholder="검색어를 입력해주세요" name="search">
					
					  <div id="resultArea">
					    <table class="table table-striped table-bordered table-hover my-3">
					      <caption>검색 결과</caption>
					      <thead>
					        <tr>
					          <th scope="col">NO</th>
					          <th scope="col">TITLE</th>
					          <th scope="col">NAME</th>
					          <th scope="col">DATE</th>
					          <th scope="col">HIT</th>
					        </tr>
					      </thead>
					      <tbody>
					        <!-- AJAX 결과가 여기에 들어감 -->
					      </tbody>
					    </table>
					    <!-- 페이징 버튼 영역 -->
					    <div id="pagingArea" class="mt-2 text-center"  ></div>
					  </div>
					</div>
					<!-- 검색 part -->		
					<!-- 검색 part -->			
					<script>
					$(function(){
						////////////////////////////////////////
						//#1. 검색어 입력이벤트
						$("#search").on("keyup" ,  function(){
							let keyword = $(this).val().trim();
							console.log(".... " + keyword);
							
							if(keyword === ""){
								$("#resultArea  tbody") 
									.empty()
									.append("<tr><td colspan='5'>검색어를 입력해주세요.</td></tr>");
								$("#pagingArea").empty();
							}
							else{ loadPage(keyword , 1); } // 검색시 첫페이지 부터 로드
						});
			
						////////////////////////////////////////
						//#2. 페이징처리
						function loadPage(keyword, pageNo){
							$.ajax({
								url:"/legacy/board/search" , 
								type:"GET" , 
								data: {keyword : keyword , pageNo : pageNo} , 
								success:function(res){
									//console.log( res );
									//1. 결과 리스트출력
									$("#resultArea  tbody").empty();
									$.each( res.list , function(  index, dto){  
										let no  = res.paging.listtotal-((res.paging.current-1)*res.paging.onepagelist) - index; 
										let row = `
										   <tr>
												<td>${no}</td>
												<td><a href="detail?id=${dto.id}">${dto.btitle}</a></td>
												<td>${dto.appUserId}</td>
												<td>${dto.createdAt}</td>
												<td>${dto.bhit}</td>
										   </tr>
										`;  //템플릿리터럴
										$("#resultArea  tbody").append(row);
									});
			
									///////////////////////////////////////////////////////////
									//2. 페이징버튼
									let  pagingHtml = "";
									
									if( res.paging.start > 1 ){
										pagingHtml += 
											`<button class="btn btn-sm  btn-outline-primary pageBtn" data-page="${res.paging.start-1}">이전</button>`;
									}
									
									for(let i=res.paging.start ; i <= res.paging.end; i++){
										const active =  i === res.paging.current ? "btn-primary" : "btn-outline-primary";
										pagingHtml += `<button class="btn btn-sm ${active} pageBtn"  data-page="${i}" >${i}</button>`;
									}
									
									if( res.paging.end < res.paging.pagetotal ){
										pagingHtml += 
											`<button class="btn btn-sm  btn-outline-primary pageBtn" data-page="${res.paging.end+1}">다음</button>`;
									}
									
									
									$("#pagingArea").html(pagingHtml);
			
									///////////////////////////////////////////////////////////
									//3. 동적요소에 버튼클릭 이벤트 위임.
									$(document).on("click" , ".pageBtn" , function(){
										const newPage = $(this).data("page");
										const keyword = $("#search").val();
										loadPage(keyword, newPage);
									});
									///////////////////////////////////////////////////////////
								},
								error : function( xhr, status, error  ){   
									console.log("status : " + status);  //요청상태 (error, timeout......)
									console.log("error  : " + error);   // 에러메시지
									console.log("xhr    : " + xhr.responseText); // 서버반환내용
								}
							});
						}
					});	
					</script>	
					<!-- 검색 part -->		
					<!-- 검색 part -->				    	
			    	
				</div>
				<div class="col-sm-6">
					<!-- https://www.w3schools.com/bootstrap5/bootstrap_collapse.php  -->
			    	<h3>공지사항</h3>
					<div id="accordion"> 
					  <div class="card"  th:each="dto, stat : ${list}"  th:if="${stat.index<3}">
					    <div class="card-header   bg-primary">
					      <a class="btn text-white" data-bs-toggle="collapse" 
					      	 th:text="${dto.btitle}"
					      	 th:href="'#collapseOne' + ${stat.index}">
					      <!--  Q1. a태그의 내용 dto.btitle / card-body dto.bcontent
					       		Q2. 첫번째 콜렉스만 열어놓기  /  Q3. card-header 색상을 primary  -->
					      </a>
					    </div>
					    <div th:id="'collapseOne' + ${stat.index}" 
					    	 class="collapse" 
					    	 th:classappend="${stat.index == 0} ? 'show'"
					    	 data-bs-parent="#accordion">
					      <div class="card-body"   th:text="${dto.bcontent}"> 
					      </div>
					    </div>
					  </div>  
					</div>
				</div>
			</div>
		</div>
		 
		<!-- TABS -->
		<!-- TABS -->
		<div class="bg-tabs-gradient py-5">
		<div class="mytabs  container bg-white  rounded-3" >
			<div class="row">
				<!-- Nav tabs -->
				<ul class="nav nav-tabs nav-justified">
				  <li class="nav-item" th:each="dto, stat : ${list}" th:if="${stat.index < 3}">
				    <a class="nav-link"
				       th:classappend="${stat.index == 0} ? 'active'"
				       data-bs-toggle="tab" 
				       th:href="'#home' + ${stat.index}"
				       th:text="${dto.btitle}"></a>
				  </li>
				</ul>
				
				<!-- Tab panes -->
				<div class="tab-content">
				  <div class="tab-pane container fade"  th:each="dto, stat : ${list}"   th:if="${stat.index < 3}"
				  	   th:id="'home' + ${stat.index}" 
				  	   th:classappend="${stat.index==0} ? 'show active'">
				  		<div class="p-3"  th:text="${dto.bcontent}" ></div>
				  </div> 
				</div>
			</div>
		</div>	
		</div>
		<!-- https://www.w3schools.com/bootstrap5/bootstrap_navs.php -->
		<!--  -->
		
	</div> 
	<!--    http://localhost:8484/ -->
</body>
</html>